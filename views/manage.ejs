<!-- add header -->
<%- include('includes/_header') %>
<!-- end header -->
<!-- Main section -->
<main id="main">
	<a href="/add-drug">
		<button id="new">New Drug <i class="fas fa-pills"></i></button>
	</a>

	<table>	
		<thead>
			<tr>
				<th>ID</th>
				<th>Drug Name</th>
				<th>Tablets per Card</th>
				<th>Tablets per Pack</th>
				<th>Taken per Day</th>
				<th>Daily dosage</th>
				<th>Action</th>
			</tr>
		</thead>
		<tbody>
			<!-- Loop through drugs -->
			<% for(let i = 0; i < drugs.length; i++) {%>
			<tr>
				<td><%= i + 1 %></td>
				<td><%= drugs[i].name %></td>
				<td><%= drugs[i].card %></td>
				<td><%= drugs[i].pack %></td>
				<td><%= drugs[i].perDay %></td>
				<td><%= drugs[i].dosage %></td>
				<td>
					<a href="/update-drug?id=<%= drugs[i]._id%>">
						<span class='fa fa-edit'></span>
					</a>
					<a class="delete" data-id=<%= drugs[i]._id%> ><!-- give each delete button a unique ID -->
						<span class='fa fa-trash'></span>
					</a>
				</td>
			</tr>
			<% } %> <!--  End loop -->
		</tbody>
	</table>
</main>
<!-- Script xử lý delete -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const deleteButtons = document.querySelectorAll(".delete");

    deleteButtons.forEach(btn => {
  btn.addEventListener("click", function() {
    const id = this.getAttribute("data-id");

    if (!confirm("Bạn có chắc muốn xóa thuốc này không?")) {
      return; // nếu bấm Cancel thì thoát, không xóa
    }

    fetch(`/api/drugs/${id}`, { method: "DELETE" })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        this.closest("tr").remove();
      })
      .catch(err => {
        console.error(err);
        alert("Failed to delete drug!");
      });
  });
});

  });
</script>
<!-- End main section -->
<!-- add footer -->
<%- include('includes/_footer') %>
<!-- end footer